<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Danh S√°ch Game & Skin</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white font-sans">
    <div class="container mx-auto p-6">
        <!-- Header v·ªõi c√°c n√∫t ƒëƒÉng nh·∫≠p/ƒëƒÉng k√Ω ho·∫∑c ƒëƒÉng xu·∫•t -->
        <div class="mb-6">
            <div class="flex justify-between items-center mb-2">
                <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-orange-400 to-pink-600">
                    üî• Danh S√°ch Game & Skin üî•
                </h1>
                {% if is_authenticated %}
                <div class="flex items-center space-x-4">
                    <p>Xin ch√†o, {{ current_user.username }}!</p>
                    <a href="{{ url_for('auth.logout') }}" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">ƒêƒÉng Xu·∫•t</a>
                </div>
                {% else %}
                <div class="space-x-4">
                    <button onclick="showModal('login-modal')" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">ƒêƒÉng Nh·∫≠p</button>
                </div>
                {% endif %}
            </div>
            <!-- Slideshow -->
            <div class="relative w-full overflow-hidden mb-4">
                <div id="slideshow" class="flex transition-transform duration-300 ease-linear whitespace-nowrap">
                    {% if skins %}
                        {% for skin in skins %}
                        <div class="inline-block flex-shrink-0 w-48 h-48 mx-2">
                            <img src="{{ skin.image }}" alt="{{ skin.name }}" class="w-full h-full object-cover rounded" />
                        </div>
                        {% endfor %}
                        <!-- Nh√¢n ƒë√¥i h√¨nh ·∫£nh ƒë·ªÉ t·∫°o hi·ªáu ·ª©ng l·∫∑p v√¥ h·∫°n -->
                        {% for skin in skins %}
                        <div class="inline-block flex-shrink-0 w-48 h-48 mx-2">
                            <img src="{{ skin.image }}" alt="{{ skin.name }}" class="w-full h-full object-cover rounded" />
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="inline-block flex-shrink-0 w-48 h-48 mx-2 bg-gray-700 rounded flex items-center justify-center">
                            <p>Ch∆∞a c√≥ skin</p>
                        </div>
                    {% endif %}
                </div>
            </div>
            <!-- Form t√¨m ki·∫øm -->
            <form action="{{ url_for('auth.index') }}" method="GET" class="flex space-x-2 mb-4">
                <input type="text" name="search" placeholder="T√¨m game ho·∫∑c skin..." value="{{ search_query|default('') }}" class="w-full bg-gray-700 border border-gray-600 p-2 rounded text-white" />
                <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">T√¨m ki·∫øm</button>
            </form>
        </div>

        <!-- Th√¥ng b√°o flash -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="mb-4">
            {% for category, message in messages %}
            <div class="p-4 rounded {{ 'bg-green-600' if category == 'success' else 'bg-red-600' }}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        <!-- Modal ƒëƒÉng nh·∫≠p -->
        <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center hidden z-50">
            <div class="bg-gray-800 p-6 rounded max-w-md w-full">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold">ƒêƒÉng Nh·∫≠p</h2>
                    <button onclick="hideModal('login-modal')" class="text-2xl text-white hover:text-red-500">√ó</button>
                </div>
                <form action="{{ url_for('auth.login') }}" method="POST">
                    <div class="mb-4">
                        <label for="login-username" class="block text-sm font-medium">T√™n ng∆∞·ªùi d√πng</label>
                        <input type="text" id="login-username" name="username" class="w-full bg-gray-700 border border-gray-600 p-2 rounded text-white" required>
                    </div>
                    <div class="mb-4">
                        <label for="login-password" class="block text-sm font-medium">M·∫≠t kh·∫©u</label>
                        <input type="password" id="login-password" name="password" class="w-full bg-gray-700 border border-gray-600 p-2 rounded text-white" required>
                    </div>
                    <button type="submit" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">ƒêƒÉng Nh·∫≠p</button>
                </form>
            </div>
        </div>

        <!-- Modal ƒëƒÉng k√Ω -->
        <div id="register-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center hidden z-50">
            <div class="bg-gray-800 p-6 rounded max-w-md w-full">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold">ƒêƒÉng K√Ω</h2>
                    <button onclick="hideModal('register-modal')" class="text-2xl text-white hover:text-red-500">√ó</button>
                </div>
                <form action="{{ url_for('auth.register') }}" method="POST">
                    <div class="mb-4">
                        <label for="register-username" class="block text-sm font-medium">T√™n ng∆∞·ªùi d√πng</label>
                        <input type="text" id="register-username" name="username" class="w-full bg-gray-700 border border-gray-600 p-2 rounded text-white" required>
                    </div>
                    <div class="mb-4">
                        <label for="register-password" class="block text-sm font-medium">M·∫≠t kh·∫©u</label>
                        <input type="password" id="register-password" name="password" class="w-full bg-gray-700 border border-gray-600 p-2 rounded text-white" required>
                    </div>
                    <button type="submit" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">ƒêƒÉng K√Ω</button>
                </form>
            </div>
        </div>

        <!-- Modal ƒëƒÉng k√Ω th√†nh c√¥ng -->
        <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center {{ 'hidden' if not register_success else '' }} z-50">
            <div class="bg-gray-800 p-6 rounded max-w-md w-full text-center">
                <h2 class="text-xl font-semibold mb-4">ƒêƒÉng k√Ω th√†nh c√¥ng!</h2>
                <button onclick="showModal('login-modal'); hideModal('success-modal')" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">ƒêƒÉng Nh·∫≠p</button>
            </div>
        </div>

        <!-- K·∫øt qu·∫£ t√¨m ki·∫øm ho·∫∑c giao di·ªán m·∫∑c ƒë·ªãnh -->
        {% if search_query %}
            <!-- Hi·ªÉn th·ªã k·∫øt qu·∫£ t√¨m ki·∫øm -->
            <h2 class="text-2xl font-semibold mb-4">K·∫øt qu·∫£ t√¨m ki·∫øm cho "{{ search_query }}"</h2>
            {% if search_results.games or search_results.skins %}
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    <!-- Hi·ªÉn th·ªã game t√¨m ƒë∆∞·ª£c -->
                    {% for game in search_results.games %}
                    <div class="bg-gray-800 rounded-lg overflow-hidden shadow-lg">
                        <div class="p-4">
                            <h3 class="text-xl font-semibold mb-2">{{ game.name }}</h3>
                            <p class="text-gray-400">Th·ªÉ lo·∫°i: {{ game.genre }}</p>
                            <p class="text-gray-400">NƒÉm ph√°t h√†nh: {{ game.release_year }}</p>
                        </div>
                        {% if game.skins %}
                        <div class="p-4">
                            <h4 class="text-lg font-semibold mb-2">Skin:</h4>
                            <div class="grid grid-cols-1 gap-4">
                                {% for skin in game.skins %}
                                <div class="bg-gray-700 rounded-lg overflow-hidden">
                                    <img src="{{ skin.image }}" alt="{{ skin.name }}" class="w-full h-48 object-cover" />
                                    <div class="p-4">
                                        <h5 class="text-md font-semibold">{{ skin.name }}</h5>
                                        <p class="text-gray-400">ƒê·ªô hi·∫øm: {{ skin.rarity }}</p>
                                        <p class="text-gray-400">Gi√°: {{ skin.price }}</p>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                    <!-- Hi·ªÉn th·ªã skin t√¨m ƒë∆∞·ª£c (kh√¥ng g·∫Øn v·ªõi game c·ª• th·ªÉ) -->
                    {% for skin in search_results.skins %}
                    <div class="bg-gray-800 rounded-lg overflow-hidden shadow-lg">
                        <div class="p-4">
                            <h3 class="text-xl font-semibold mb-2">Skin: {{ skin.name }}</h3>
                            <p class="text-gray-400">Game: {{ skin.game_name|default('Kh√¥ng x√°c ƒë·ªãnh') }}</p>
                        </div>
                        <div class="p-4">
                            <div class="bg-gray-700 rounded-lg overflow-hidden">
                                <img src="{{ skin.image }}" alt="{{ skin.name }}" class="w-full h-48 object-cover" />
                                <div class="p-4">
                                    <h5 class="text-md font-semibold">{{ skin.name }}</h5>
                                    <p class="text-gray-400">ƒê·ªô hi·∫øm: {{ skin.rarity }}</p>
                                    <p class="text-gray-400">Gi√°: {{ skin.price }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="p-4 bg-gray-800 rounded text-center">
                    <p>Kh√¥ng t√¨m th·∫•y game ho·∫∑c skin n√†o kh·ªõp v·ªõi "{{ search_query }}".</p>
                </div>
            {% endif %}
        {% else %}
            <!-- Giao di·ªán m·∫∑c ƒë·ªãnh -->
            {% if is_authenticated %}
            <!-- Giao di·ªán b·∫£ng cho ng∆∞·ªùi d√πng ƒë√£ ƒëƒÉng nh·∫≠p -->
            <div class="mb-6">
                <button onclick="showAddGameForm()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 flex items-center">
                    <span class="mr-2">+</span> Th√™m Game M·ªõi
                </button>
            </div>

            <!-- Form th√™m game m·ªõi -->
            <div id="add-game-form" class="hidden mb-6 p-4 bg-gray-800 rounded">
                <h2 class="text-xl font-semibold mb-2">Th√™m Game M·ªõi</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <input id="new-game-name" type="text" placeholder="T√™n game" class="bg-gray-700 border border-gray-600 p-2 rounded text-white" />
                    <input id="new-game-genre" type="text" placeholder="Th·ªÉ lo·∫°i" class="bg-gray-700 border border-gray-600 p-2 rounded text-white" />
                    <input id="new-game-release-year" type="text" placeholder="NƒÉm ph√°t h√†nh" class="bg-gray-700 border border-gray-600 p-2 rounded text-white" />
                </div>
                <button onclick="addGame()" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Th√™m</button>
            </div>

            <!-- B·∫£ng danh s√°ch game -->
            <table class="w-full bg-gray-800 rounded">
                <thead>
                    <tr class="bg-gray-700">
                        <th class="p-3 text-left">Game</th>
                        <th class="p-3 text-left">Th·ªÉ Lo·∫°i</th>
                        <th class="p-3 text-left">NƒÉm Ph√°t H√†nh</th>
                        <th class="p-3 text-left">H√†nh ƒê·ªông</th>
                    </tr>
                </thead>
                <tbody id="game-list">
                    {% for game in games %}
                    <tr class="border-b border-gray-700" onclick="toggleSkins('{{ game._id }}')" style="cursor: pointer;">
                        <td class="p-3">{{ game.name }}</td>
                        <td class="p-3">{{ game.genre }}</td>
                        <td class="p-3">{{ game.release_year }}</td>
                        <td class="p-3 flex space-x-2">
                            <button onclick="showEditGame(event, '{{ game._id }}', '{{ game.name }}', '{{ game.genre }}', '{{ game.release_year }}')" class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600">S·ª≠a</button>
                            <button onclick="deleteGame(event, '{{ game._id }}')" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">X√≥a</button>
                            <button onclick="showAddSkinForm(event, '{{ game._id }}')" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600">Th√™m Skin</button>
                        </td>
                    </tr>
                    <!-- Form s·ª≠a game -->
                    <tr id="edit-game-{{ game._id }}" class="hidden">
                        <td colspan="4" class="p-4 bg-gray-700">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <input id="edit-game-name-{{ game._id }}" type="text" value="{{ game.name }}" class="bg-gray-600 border border-gray-500 p-2 rounded text-white" />
                                <input id="edit-game-genre-{{ game._id }}" type="text" value="{{ game.genre }}" class="bg-gray-600 border border-gray-500 p-2 rounded text-white" />
                                <input id="edit-game-release-year-{{ game._id }}" type="text" value="{{ game.release_year }}" class="bg-gray-600 border border-gray-500 p-2 rounded text-white" />
                            </div>
                            <button onclick="updateGame('{{ game._id }}')" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">C·∫≠p nh·∫≠t</button>
                        </td>
                    </tr>
                    <!-- B·∫£ng danh s√°ch skin -->
                    <tr id="skins-{{ game._id }}" class="hidden">
                        <td colspan="4" class="p-4 bg-gray-700">
                            <h4 class="text-lg font-semibold mb-2">Skin c·ªßa {{ game.name }}:</h4>
                            <!-- Form th√™m skin m·ªõi -->
                            <div id="add-skin-form-{{ game._id }}" class="hidden mb-4 p-4 bg-gray-800 rounded">
                                <h5 class="text-md font-semibold mb-2">Th√™m Skin M·ªõi</h5>
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <input id="new-skin-name-{{ game._id }}" type="text" placeholder="T√™n skin" class="bg-gray-600 border border-gray-500 p-2 rounded text-white" />
                                    <input id="new-skin-rarity-{{ game._id }}" type="text" placeholder="ƒê·ªô hi·∫øm" class="bg-gray-600 border border-gray-500 p-2 rounded text-white" />
                                    <input id="new-skin-price-{{ game._id }}" type="text" placeholder="Gi√°" class="bg-gray-600 border border-gray-500 p-2 rounded text-white" />
                                    <input id="new-skin-image-{{ game._id }}" type="text" placeholder="URL h√¨nh ·∫£nh" class="bg-gray-600 border border-gray-500 p-2 rounded text-white" />
                                </div>
                                <button onclick="addSkin('{{ game._id }}')" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Th√™m Skin</button>
                            </div>
                            <!-- B·∫£ng danh s√°ch skin -->
                            <table class="w-full bg-gray-800 rounded">
                                <thead>
                                    <tr class="bg-gray-700">
                                        <th class="p-3 text-left">T√™n Skin</th>
                                        <th class="p-3 text-left">ƒê·ªô Hi·∫øm</th>
                                        <th class="p-3 text-left">Gi√°</th>
                                        <th class="p-3 text-left">H√†nh ƒê·ªông</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for skin in game.skins %}
                                    <tr class="border-b border-gray-700">
                                        <td class="p-3 flex items-center">
                                            <img src="{{ skin.image }}" alt="{{ skin.name }}" class="w-20 h-20 object-cover rounded mr-2" />
                                            {{ skin.name }}
                                        </td>
                                        <td class="p-3">{{ skin.rarity }}</td>
                                        <td class="p-3">{{ skin.price }}</td>
                                        <td class="p-3 flex space-x-2">
                                            <button onclick="showEditSkin(event, '{{ game._id }}', '{{ skin._id }}', '{{ skin.name }}', '{{ skin.rarity }}', '{{ skin.price }}', '{{ skin.image }}')" class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600">S·ª≠a</button>
                                            <button onclick="deleteSkin(event, '{{ game._id }}', '{{ skin._id }}')" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">X√≥a</button>
                                        </td>
                                    </tr>
                                    <!-- Form s·ª≠a skin -->
                                    <tr id="edit-skin-{{ skin._id }}" class="hidden">
                                        <td colspan="4" class="p-4 bg-gray-600">
                                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                                <input id="edit-skin-name-{{ skin._id }}" type="text" value="{{ skin.name }}" class="bg-gray-500 border border-gray-400 p-2 rounded text-white" />
                                                <input id="edit-skin-rarity-{{ skin._id }}" type="text" value="{{ skin.rarity }}" class="bg-gray-500 border border-gray-400 p-2 rounded text-white" />
                                                <input id="edit-skin-price-{{ skin._id }}" type="text" value="{{ skin.price }}" class="bg-gray-500 border border-gray-400 p-2 rounded text-white" />
                                                <input id="edit-skin-image-{{ skin._id }}" type="text" value="{{ skin.image }}" class="bg-gray-500 border border-gray-400 p-2 rounded text-white" />
                                            </div>
                                            <button onclick="updateSkin('{{ game._id }}', '{{ skin._id }}')" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">C·∫≠p nh·∫≠t</button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <!-- Giao di·ªán l∆∞·ªõi cho ng∆∞·ªùi d√πng ch∆∞a ƒëƒÉng nh·∫≠p -->
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                {% for game in games %}
                <div class="bg-gray-800 rounded-lg overflow-hidden shadow-lg">
                    <div class="p-4">
                        <h3 class="text-xl font-semibold mb-2">{{ game.name }}</h3>
                        <p class="text-gray-400">Th·ªÉ lo·∫°i: {{ game.genre }}</p>
                        <p class="text-gray-400">NƒÉm ph√°t h√†nh: {{ game.release_year }}</p>
                    </div>
                    {% if game.skins %}
                    <div class="p-4">
                        <h4 class="text-lg font-semibold mb-2">Skin:</h4>
                        <div class="grid grid-cols-1 gap-4">
                            {% for skin in game.skins %}
                            <div class="bg-gray-700 rounded-lg overflow-hidden">
                                <img src="{{ skin.image }}" alt="{{ skin.name }}" class="w-full h-48 object-cover" />
                                <div class="p-4">
                                    <h5 class="text-md font-semibold">{{ skin.name }}</h5>
                                    <p class="text-gray-400">ƒê·ªô hi·∫øm: {{ skin.rarity }}</p>
                                    <p class="text-gray-400">Gi√°: {{ skin.price }}</p>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% endif %}
        {% endif %}

        <!-- Modal xem ·∫£nh l·ªõn -->
        <div id="image-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center hidden z-50">
            <div class="relative max-w-4xl max-h-[90vh]">
                <button id="close-modal" class="absolute top-2 right-2 text-white text-3xl font-bold hover:text-red-500 cursor-pointer">√ó</button>
                <img id="modal-image" src="" alt="Xem ·∫£nh" class="max-w-full max-h-[90vh] rounded" />
            </div>
        </div>

        <script>
            // H√†m hi·ªÉn th·ªã modal
            function showModal(modalId) {
                document.getElementById(modalId).classList.remove('hidden');
            }

            // H√†m ·∫©n modal
            function hideModal(modalId) {
                document.getElementById(modalId).classList.add('hidden');
            }

            // Slideshow
            document.addEventListener('DOMContentLoaded', () => {
                const slideshow = document.getElementById('slideshow');
                if (slideshow) {
                    let position = 0;
                    const slideWidth = 208; // 192px (w-48) + 8px (mx-2) + 8px (mx-2)
                    const totalSlides = slideshow.children.length / 2; // Ch·ªâ t√≠nh n·ª≠a ƒë·∫ßu (tr∆∞·ªõc khi nh√¢n ƒë√¥i)
                    const maxPosition = totalSlides * slideWidth;

                    function slide() {
                        position -= 1; // Di chuy·ªÉn sang tr√°i
                        if (Math.abs(position) >= maxPosition) {
                            position = 0; // Reset v·ªÅ ƒë·∫ßu ƒë·ªÉ l·∫∑p v√¥ h·∫°n
                        }
                        slideshow.style.transform = `translateX(${position}px)`;
                        requestAnimationFrame(slide);
                    }

                    requestAnimationFrame(slide);
                }
            });

            // Script cho ng∆∞·ªùi d√πng ƒë√£ ƒëƒÉng nh·∫≠p
            {% if is_authenticated %}
            function showAddGameForm() {
                const form = document.getElementById('add-game-form');
                form.classList.toggle('hidden');
            }

            function addGame() {
                const name = document.getElementById('new-game-name').value.trim();
                const genre = document.getElementById('new-game-genre').value.trim();
                const release_year = document.getElementById('new-game-release-year').value.trim();
                if (!name || !genre || !release_year) {
                    alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin');
                    return;
                }
                fetch('/api/games', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, genre, release_year }),
                })
                .then(res => res.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error);
                    } else {
                        location.reload();
                    }
                })
                .catch(() => alert('L·ªói m·∫°ng, th·ª≠ l·∫°i sau'));
            }

            function showEditGame(e, id, name, genre, release_year) {
                e.stopPropagation();
                const editRow = document.getElementById(`edit-game-${id}`);
                if (!editRow) return;
                editRow.classList.toggle('hidden');
            }

            function updateGame(id) {
                const name = document.getElementById(`edit-game-name-${id}`).value.trim();
                const genre = document.getElementById(`edit-game-genre-${id}`).value.trim();
                const release_year = document.getElementById(`edit-game-release-year-${id}`).value.trim();
                if (!name || !genre || !release_year) {
                    alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin');
                    return;
                }
                fetch(`/api/games/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, genre, release_year }),
                })
                .then(res => res.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error);
                    } else {
                        location.reload();
                    }
                })
                .catch(() => alert('L·ªói m·∫°ng, th·ª≠ l·∫°i sau'));
            }

            function deleteGame(e, id) {
                e.stopPropagation();
                if (!confirm('X√°c nh·∫≠n x√≥a game?')) return;
                fetch(`/api/games/${id}`, { method: 'DELETE' })
                    .then(res => res.json())
                    .then(data => {
                        if (data.error) alert(data.error);
                        else location.reload();
                    })
                    .catch(() => alert('L·ªói m·∫°ng, th·ª≠ l·∫°i sau'));
            }

            function toggleSkins(gameId) {
                const skinsRow = document.getElementById(`skins-${gameId}`);
                if (!skinsRow) return;
                skinsRow.classList.toggle('hidden');
            }

            function showAddSkinForm(e, gameId) {
                e.stopPropagation();
                const form = document.getElementById(`add-skin-form-${gameId}`);
                if (!form) return;
                form.classList.toggle('hidden');
            }

            function addSkin(gameId) {
                const name = document.getElementById(`new-skin-name-${gameId}`).value.trim();
                const rarity = document.getElementById(`new-skin-rarity-${gameId}`).value.trim();
                const price = document.getElementById(`new-skin-price-${gameId}`).value.trim();
                const image = document.getElementById(`new-skin-image-${gameId}`).value.trim();
                if (!name || !rarity || !price || !image) {
                    alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin skin');
                    return;
                }
                fetch(`/api/games/${gameId}/skins`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, rarity, price, image }),
                })
                .then(res => res.json())
                .then(data => {
                    if (data.error) alert(data.error);
                    else location.reload();
                })
                .catch(() => alert('L·ªói m·∫°ng, th·ª≠ l·∫°i sau'));
            }

            function showEditSkin(e, gameId, skinId, name, rarity, price, image) {
                e.stopPropagation();
                const editRow = document.getElementById(`edit-skin-${skinId}`);
                if (!editRow) return;
                editRow.classList.toggle('hidden');
            }

            function updateSkin(gameId, skinId) {
                const name = document.getElementById(`edit-skin-name-${skinId}`).value.trim();
                const rarity = document.getElementById(`edit-skin-rarity-${skinId}`).value.trim();
                const price = document.getElementById(`edit-skin-price-${skinId}`).value.trim();
                const image = document.getElementById(`edit-skin-image-${skinId}`).value.trim();
                if (!name || !rarity || !price || !image) {
                    alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin skin');
                    return;
                }
                fetch(`/api/games/${gameId}/skins/${skinId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, rarity, price, image }),
                })
                .then(res => res.json())
                .then(data => {
                    if (data.error) alert(data.error);
                    else location.reload();
                })
                .catch(() => alert('L·ªói m·∫°ng, th·ª≠ l·∫°i sau'));
            }

            function deleteSkin(e, gameId, skinId) {
                e.stopPropagation();
                if (!confirm('X√°c nh·∫≠n x√≥a skin?')) return;
                fetch(`/api/games/${gameId}/skins/${skinId}`, { method: 'DELETE' })
                    .then(res => res.json())
                    .then(data => {
                        if (data.error) alert(data.error);
                        else location.reload();
                    })
                    .catch(() => alert('L·ªói m·∫°ng, th·ª≠ l·∫°i sau'));
            }
            {% endif %}

            // Modal xem ·∫£nh l·ªõn
            document.addEventListener('DOMContentLoaded', () => {
                document.querySelectorAll('img').forEach(img => {
                    img.style.cursor = 'zoom-in';
                    img.addEventListener('click', e => {
                        e.stopPropagation();
                        const modal = document.getElementById('image-modal');
                        const modalImg = document.getElementById('modal-image');
                        modalImg.src = e.target.src;
                        modal.classList.remove('hidden');
                    });
                });

                document.getElementById('close-modal').addEventListener('click', () => {
                    document.getElementById('image-modal').classList.add('hidden');
                });

                document.getElementById('image-modal').addEventListener('click', e => {
                    if (e.target.id === 'image-modal') {
                        document.getElementById('image-modal').classList.add('hidden');
                    }
                });

                // ƒê√≥ng modal khi click b√™n ngo√†i
                document.querySelectorAll('#login-modal, #register-modal, #success-modal').forEach(modal => {
                    modal.addEventListener('click', e => {
                        if (e.target === modal) {
                            modal.classList.add('hidden');
                        }
                    });
                });
            });
        </script>

        <style>
            .modal.hidden {
                display: none;
            }
        </style>
</body>
</html>
